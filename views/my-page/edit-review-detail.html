{{ define "my-page/edit-review-detail.html" }}

<!DOCTYPE html>
<html lang="ko">
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
    <link rel="stylesheet" href="/contents/css/common.css?v={{ .cssRandomVersion }}">
    <link rel="stylesheet" href="/contents/mypage/css/mypage.css?v={{ .cssRandomVersion }}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/contents/mypage/css/sass.css?v={{ .cssRandomVersion }}">
    <link rel="stylesheet" href="/contents/mypage/css/theme.css?v={{ .cssRandomVersion }}">
    <link rel="stylesheet" href="/contents/mypage/css/star-rating.css?v={{ .cssRandomVersion }}">
    {{ template "shared/header.tmpl" . }}
    <script src="https://kit.fontawesome.com/7e24956d25.js" crossorigin="anonymous"></script>
    {{ template "shared/title.tmpl" . }}
  </head>
  <body>
    {{ template "shared/nav.tmpl" . }}
    {{ template "shared/nav-title.tmpl" . }}
    
    {{ template "shared/review-detail.tmpl" . }}
    {{ template "shared/extend-token.tmpl" . }}

    <script type="text/javascript">
      var editElem = document.querySelector("#edit-review-button")
      var saveElem = document.querySelector("#save-review-button")

      $(document).ready(function () {
        $(".kv-ltr-theme-svg-star").rating({
          hoverOnClear: false,
          theme: "krajee-svg",
          showCaption: false,
          readonly: false,
          min: 0,
          step: 0.5,
          max: 5,
        });

        // 수정하기 버튼 숨기기
        if (editElem !== null) {
          editElem.style.display = "none"
        }

        // 저장하기 버튼 드러내기
        if (saveElem !== null) {
          saveElem.style.display = ""
        }

        if (getCookie("reviewNo") === null) {
          Swal.fire("선택된 리뷰가 없습니다.")
          return
        }
      });

      var reviewNo;
      if (saveElem !== null) {
        saveElem.addEventListener("click", function() {
          const minDescLength = 10
          const descCorrect = isReviewDescCorrect(minDescLength) 
          if (!descCorrect) {
            Swal.fire(`리뷰는 최소 ${minDescLength}자 이상 입력해야합니다.`)
            return
          }

          function reviewItemSuccessFunc() {
            Swal.fire("리뷰 등록 완료")
              .then(function(result) {
                location.href = "/web/my-page/review/list"
              })
          }

          function reviewItemFailFunc(responseText) {
            Swal.fire("리뷰 수정 실패")
            return
          }

          function reviewSuccessFunc() {
            var reviewNo = parseInt(getCookie("reviewNo"), 10)
            requestForManipulateItemReview(reviewNo, reviewItemSuccessFunc, reviewItemFailFunc, true, "edit")
          }

          function reviewFailFunc(responseText) {
            Swal.fire("리뷰 수정 실패")
            return
          }

          requestForManipulateReview(reviewSuccessFunc, reviewFailFunc, true, "edit")
        })
      }
    </script>
  </body>
</html>

{{ end }}